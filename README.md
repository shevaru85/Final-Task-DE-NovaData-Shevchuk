# –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ Data Engineering

## üìä –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –§–∞–π–ª `russian_houses.csv` (~300 –ú–ë, 590 708 —Å—Ç—Ä–æ–∫) –ù–ï –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```powershell
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
.\download_data.ps1
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
1. –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª –ø–æ —Å—Å—ã–ª–∫–µ: https://drive.google.com/file/d/1nVf9A7d0MzsVmDR0k_UMugtVLqVG4Gm9/view?usp=sharing
2. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ: `dags/russian_houses.csv`
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ: UTF-16

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ sample –¥–∞–Ω–Ω—ã—Ö
–î–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sample —Ñ–∞–π–ª (10 —Å—Ç—Ä–æ–∫):
```
sample_data/russian_houses_sample.csv
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∂–∏–ª—ã—Ö –¥–æ–º–∞—Ö –†–æ—Å—Å–∏–∏ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------|-----|----------|--------|
| `house_id` | String | ID –æ–±—ä–µ–∫—Ç–∞ | 590707 |
| `latitude` | Float64 | –®–∏—Ä–æ—Ç–∞ | 55.060199 |
| `longitude` | Float64 | –î–æ–ª–≥–æ—Ç–∞ | 32.695577 |
| `maintenance_year` | Int32 | –ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ | 1953 |
| `square` | Float64 | –ü–ª–æ—â–∞–¥—å (–∫–≤.–º) | 585.60 |
| `population` | Int32 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π | 18 |
| `region` | String | –û–±–ª–∞—Å—Ç—å | –°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å |
| `locality_name` | String | –ì–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç | –Ø—Ä—Ü–µ–≤–æ |
| `address` | String | –ê–¥—Ä–µ—Å | —É–ª. –ë—Ä–∞—Ç—å–µ–≤ –®–∞—Ä—à–∞–Ω–æ–≤—ã—Ö, –¥. 61 |
| `full_address` | String | –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å | –°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –Ø—Ä—Ü–µ–≤–æ, —É–ª. –ë—Ä–∞—Ç—å–µ–≤ –®–∞—Ä—à–∞–Ω–æ–≤—ã—Ö, –¥. 61 |
| `communal_service_id` | Float64 | ID —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ | - |
| `description` | String | –û–ø–∏—Å–∞–Ω–∏–µ | –ñ–∏–ª–æ–π –¥–æ–º –≤ –Ø—Ä—Ü–µ–≤–æ... |

---

## üìã –£—Å–ª–æ–≤–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

–ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ8

–î–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ:
ID –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 590707)
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–®–∏—Ä–æ—Ç–∞, –î–æ–ª–≥–æ—Ç–∞) (–Ω–∞–ø—Ä–∏–º–µ—Ä, 55.060199, 32.695577)
–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1953.0)
–ü–ª–æ—â–∞–¥—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 585.60)
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 18)
–û–±–ª–∞—Å—Ç—å –∏ –≥–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –Ø—Ä—Ü–µ–≤–æ)
–ê–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "—É–ª. –ë—Ä–∞—Ç—å–µ–≤ –®–∞—Ä—à–∞–Ω–æ–≤—ã—Ö, –¥. 61")
–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ñ–∏–ª–æ–π –¥–æ–º –≤ –Ø—Ä—Ü–µ–≤–æ, –ø–æ –∞–¥—Ä–µ—Å—É —É–ª. –ë—Ä–∞—Ç—å–µ–≤ –®–∞—Ä—à–∞–Ω–æ–≤—ã—Ö, –¥. 61, 1953 –≥–æ–¥–∞ –ø–æ—Å—Ç—Ä–æ–π–∫–∏, –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¢–°–ñ ¬´–®–∞—Ä—à–∞–Ω–æ–≤—ã—Ö¬ª.")
–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å?

-1. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è PySpark –∏ Clickhouse. PySpark –≤ airflow –≤ docker-compose –Ω–µ—Ç—É! –ï–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –ö—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ docker-compose - –∑–∞–¥–∞—á–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è. 

0. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ docker-compose –∏–∑ –ø–µ—Ä–≤—ã—Ö —Å—Ç–µ–ø–æ–≤! –®–∞–≥–∏ 1-7 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω—ã –≤ DAG.

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –≤ DataFrame PySpark. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫.

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫).

3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç–∞, —á–∏—Å–ª–æ).

4. –í—ã—á–∏—Å–ª–∏—Ç–µ —Å—Ä–µ–¥–Ω–∏–π –∏ –º–µ–¥–∏–∞–Ω–Ω—ã–π –≥–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∑–¥–∞–Ω–∏–π.

5. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ç–æ–ø-10 –æ–±–ª–∞—Å—Ç–µ–π –∏ –≥–æ—Ä–æ–¥–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.

6. –ù–∞–π–¥–∏—Ç–µ –∑–¥–∞–Ω–∏—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥—å—é –≤ —Ä–∞–º–∫–∞—Ö –∫–∞–∂–¥–æ–π –æ–±–ª–∞—Å—Ç–∏.

7. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–¥–∞–Ω–∏–π –ø–æ –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∫–æ–ª—å–∫–æ –∑–¥–∞–Ω–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –≤ 1950-—Ö, 1960-—Ö –∏ —Ç.–¥.).

–° –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Ä–∞–±–æ—Ç–∞–ª–∏, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Ö –∏ –≤ –ë–î –ø–æ–ª–æ–∂–∏—Ç—å. 

8. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã –≤ ClickHouse, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ —á–µ—Ä–µ–∑ airflow.

9. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å ClickHouse –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞, —É—á—Ç–∏—Ç–µ, —á—Ç–æ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤ airflow.

10. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ DataFrame –≤ —Ç–∞–±–ª–∏—Ü—É –≤ ClickHouse (airflow)

11. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –≤ Python, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–µ–¥–µ—Ç —Ç–æ–ø 25 –¥–æ–º–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –ø–ª–æ—â–∞–¥—å –±–æ–ª—å—à–µ 60 –∫–≤.–º (airflow)

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ—à–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏—Å–ª–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–∏—Ö 4) —Å–¥–∞—á–∏ –ø—Ä–æ–µ–∫—Ç–∞ - 

1. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ñ–æ—Ä–º–ª–µ–Ω —Ç–∞–∫, –∫–∞–∫ –Ω—É–∂–Ω–æ. –ê –∏–º–µ–Ω–Ω–æ –µ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —É–¥–æ–±–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, —á–∏—Ç–∞–µ–º—ã–π README, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–ª–∏—á–∏–µ —É—Å–ª–æ–≤–∏—è –∑–∞–¥–∞–Ω–∏—è. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–ª–∏—á–∏–µ docker-compose. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–ª–∏—á–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ py, –∫–æ–¥ –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–±–µ—Ä–Ω—É—Ç –≤ DAG.

2. –õ–æ–≥–∏–∫–∞. –í—Å–µ —Å–¥–µ–ª–∞–Ω–æ –≤ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ. –°–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å csv, –ø–æ—Ç–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º, –∑–∞–≥—Ä—É–∂–∞–µ–º –≤ –∫–ª–∏–∫—Ö–∞—É—Å, —á–∏—Ç–∞–µ–º —Å –∫–ª–∏–∫—Ö–∞—É—Å–∞. –í—Å–µ –ø—Ä–∏ —ç—Ç–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Airflow. –û—Ç–∫—É–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å csv - –¥—É–º–∞–µ–º –∏–ª–∏ –≥—É–≥–ª–∏–º (–∞ –ª—É—á—à–µ –æ–±–∞ —Å—Ä–∞–∑—É –¥–µ–π—Å—Ç–≤–∏—è –¥–µ–ª–∞—Ç—å)

3. –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ. –§–∞–π–ª c csv —Ö—Ä–∞–Ω–∏—Ç—å –≤ GIT –Ω–µ–ª—å–∑—è! –î–æ–±–∞–≤–ª—è–π—Ç–µ –ª–∏–±–æ —Å—Å—ã–ª–∫—É, –ª–∏–±–æ —Å—Ä–µ–∑ –¥–∞–Ω–Ω—ã—Ö.

4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å. –î–∞–Ω–Ω—ã–µ –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —Ñ–∞–π–ª –Ω–µ–ª—å–∑—è –æ–±—Ä–µ–∑–∞—Ç—å. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ SQL —Å–∫—Ä–∏–ø—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ. –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –Ω–∞ MatPlotLib –¥–ª—è 5, 6 –∏ 7 –ø—É–Ω–∫—Ç–æ–≤.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DAG

DAG —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 5 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á:

### 1. query_clickhouse
**–§—É–Ω–∫—Ü–∏—è:** `query_clickhouse()`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å `SELECT version()` —á–µ—Ä–µ–∑ HTTP API
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏—é ClickHouse

### 2. query_postgres
**–§—É–Ω–∫—Ü–∏—è:** `query_postgres()`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å `SELECT version()` —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É `psql`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PGPASSWORD` –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏—é PostgreSQL

### 3. pyspark_task
**–§—É–Ω–∫—Ü–∏—è:** `pyspark_task()`
- –°–æ–∑–¥–∞–µ—Ç PySpark —Å–µ—Å—Å–∏—é —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–∞–º—è—Ç–∏ (2GB –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–∞ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è)
- –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª `russian_houses.csv` (–∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-16) —á–µ—Ä–µ–∑ PySpark
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ—á–∏—Å—Ç–∫—É –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö:
  - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (square, maintenance_year, population, latitude, longitude)
  - –£–¥–∞–ª—è–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PySpark transformations –∏ actions –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É:
  - –ü–æ–¥—Å—á–µ—Ç –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ —Å –ø–æ–º–æ—â—å—é —Ñ–∏–ª—å—Ç—Ä–æ–≤
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (—Å—Ä–µ–¥–Ω–∏–π —á–µ—Ä–µ–∑ mean(), –º–µ–¥–∏–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ percentile_approx())
  - –¢–æ–ø-10 –æ–±–ª–∞—Å—Ç–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–±—ä–µ–∫—Ç–æ–≤ (groupBy + orderBy)
  - –¢–æ–ø-10 –Ω–∞—Å–µ–ª–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ (groupBy + orderBy)
  - –ó–¥–∞–Ω–∏—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π/–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥—å—é –≤ –∫–∞–∂–¥–æ–π –æ–±–ª–∞—Å—Ç–∏ (Window functions —Å row_number())
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è–º (floor() –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –¥–µ–∫–∞–¥)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ TSV: `/opt/airflow/dags/processed_data.csv`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç toLocalIterator() –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  - –ü–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ö–µ–º–µ ClickHouse
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PySpark —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 4. load_to_clickhouse
**–§—É–Ω–∫—Ü–∏—è:** `load_to_clickhouse()`
- –û—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `russian_houses` (TRUNCATE)
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `processed_data.csv` –≤ ClickHouse –±–∞—Ç—á–∞–º–∏ –ø–æ 10,000 —Å—Ç—Ä–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç TabSeparated
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 12)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏

### 5. query_top_houses
**–§—É–Ω–∫—Ü–∏—è:** `query_top_houses()`
- –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∑–∞–ø—Ä–æ—Å –∫ ClickHouse:
  - –í—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø-25 –¥–æ–º–æ–≤ —Å –ø–ª–æ—â–∞–¥—å—é > 60 –∫–≤.–º
  - –°–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ —É–±—ã–≤–∞–Ω–∏—é –ø–ª–æ—â–∞–¥–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `/opt/airflow/dags/top_25_houses.csv`
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
query_clickhouse >> query_postgres >> pyspark_task >> load_to_clickhouse >> query_top_houses
```

## –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã ClickHouse

```sql
CREATE TABLE IF NOT EXISTS russian_houses (
    house_id String,
    latitude Float64,
    longitude Float64,
    maintenance_year Nullable(Int32),
    square Nullable(Float64),
    population Nullable(Int32),
    region String,
    locality_name Nullable(String),
    address Nullable(String),
    full_address Nullable(String),
    communal_service_id Nullable(Float64),
    description Nullable(String)
) ENGINE = MergeTree()
ORDER BY (region, house_id);
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **ClickHouse –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** HTTP API –Ω–∞ `http://clickhouse:8123/`
- **PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:** `psql -h postgres_user -U user -d test`
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:** PySpark 3.5.0 —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–∞–º—è—Ç–∏ 2GB
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** UTF-16
- **–§–æ—Ä–º–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:** TabSeparated —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Final Task/
‚îú‚îÄ‚îÄ .gitignore                      # –ò—Å–∫–ª—é—á–∞–µ—Ç –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –∏ –ª–æ–≥–∏
‚îú‚îÄ‚îÄ README.md                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ docker-compose.yml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ Dockerfile                      # –û–±—Ä–∞–∑ Airflow —Å PySpark
‚îú‚îÄ‚îÄ start.ps1                       # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ stop.ps1                        # –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ download_data.ps1               # –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ create_clickhouse_table.sql     # SQL —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
‚îú‚îÄ‚îÄ sample_data/                    # –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ russian_houses_sample.csv   # Sample (10 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ dags/                           # Apache Airflow DAG'–∏
‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # –û—Å–Ω–æ–≤–Ω–æ–π DAG —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ russian_houses.csv          # ‚ö†Ô∏è –ù–ï –≤ Git! –°–∫–∞—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
‚îú‚îÄ‚îÄ config/                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ logs/                           # ‚ö†Ô∏è –ù–ï –≤ Git! –õ–æ–≥–∏ Airflow
‚îî‚îÄ‚îÄ plugins/                        # –ü–ª–∞–≥–∏–Ω—ã Airflow
```

### –ß—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ Git (.gitignore)

- `russian_houses.csv` - –∏—Å—Ö–æ–¥–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç (~300 –ú–ë)
- `processed_data.csv` - –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `logs/` - –ª–æ–≥–∏ Airflow
- `__pycache__/` - —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Python —Ñ–∞–π–ª—ã
- `.idea/`, `.vscode/` - —Ñ–∞–π–ª—ã IDE

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
git clone <repository-url>
cd "Final Task"
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```powershell
.\download_data.ps1
```

### 3. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```powershell
.\start.ps1
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ ClickHouse
```bash
docker exec -it clickhouse clickhouse-client --multiquery < create_clickhouse_table.sql
```

### 5. –ó–∞–ø—É—Å–∫ DAG
1. –û—Ç–∫—Ä–æ–π—Ç–µ Airflow UI: http://localhost:8080
2. –ù–∞–π–¥–∏—Ç–µ DAG `main`
3. –í–∫–ª—é—á–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ê–≤—Ç–æ—Ä:** Shevhuk
- **–í–µ—Ä—Å–∏—è:** 1.0
- **–î–∞—Ç–∞:** –Ø–Ω–≤–∞—Ä—å 2026
